"use strict";var PROTOCOL="https://",DOMAIN_GNOTES="gnotes.me",DOMAIN_SUIBIJI="suibiji.com",DOMAIN=localStorage.getItem("domain")||chrome.i18n.getMessage("defaultDomain"),SITE_DOMAIN="",SITE_API_HOST_V2="",getCookies=function(e,n){chrome.cookies.get({url:PROTOCOL+DOMAIN,name:"t"},function(t){t?(updateDomain(),e&&e()):n&&n()})},initInfoFromServer=function(e,n){var t=DOMAIN;getCookies(e,function(){DOMAIN=t==DOMAIN_GNOTES?DOMAIN_SUIBIJI:DOMAIN_GNOTES,getCookies(e,function(){DOMAIN=t,updateDomain(),n&&n(SITE_DOMAIN)})})},initDomain=function(){SITE_DOMAIN=PROTOCOL+DOMAIN+"/",SITE_API_HOST_V2=PROTOCOL+DOMAIN+"/api/v2"},updateDomain=function(){initDomain(),upgradeMenu&&upgradeMenu(),localStorage.setItem("domain",DOMAIN),localStorage.setItem("domain_api",SITE_API_HOST_V2),localStorage.setItem("site_domain",SITE_DOMAIN)},isGnotes=function(){return DOMAIN===DOMAIN_GNOTES};initDomain(),chrome.runtime.onInstalled.addListener(function(e){initInfoFromServer()}),chrome.browserAction.onClicked.addListener(function(e){start({tab:e})});var start=function(e){e.action="openFrame",initInfoFromServer(function(n){chrome.tabs.sendMessage(e.tab.id,{action:e},function(e){})},login)},login=function(e){var n=610,t=710;chrome.windows.create({url:"about:blank",width:n,height:t,type:"popup",top:Math.round(Math.max(screen.availHeight-t,0)/2),left:Math.round(Math.max(screen.availWidth-n,0)/2)},function(n){var t=n.tabs[0].id;chrome.tabs.onUpdated.addListener(function(n,o,i){t==n&&o.url==e&&chrome.tabs.remove(t)}),chrome.tabs.update(t,{url:e+"user#/login?channel=chrome_extension_open_panel"})})},menuId=null,genericOnClick=function(e,n){start({info:e,tab:n})},upgradeMenu=function(){var e=isGnotes()?"Add To GNotes":"添加到随笔记";menuId?chrome.contextMenus.update(menuId,{title:e},function(e){}):menuId=chrome.contextMenus.create({title:e,contexts:["all"],onclick:genericOnClick})};upgradeMenu();
//# sourceMappingURL=background.js.map
