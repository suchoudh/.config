{"version":3,"sources":["scripts/context.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","chrome","extension","onMessage","addListener","request","sender","sendResponse","getLocaleMessage","i18n","getMessage","createIframe","TT","iframe","document","createElement","src","runtime","id","body","appendChild","setIframePosition","listenMessage","createStatus","$status","$","append","css","visibility","position","top","left","transform","margin-top","z-index","find","display","font-size","border","background-color","padding","border-radius","box-shadow","color","line-height","_$$css","clientTop","right","height","width","window","addEventListener","data","postMessageToIframe","status","addTaskSuccess","from","removeIframe","addTaskFail","needLogin","html","target","setTimeout","remove","sendIframe","contentWindow","postMessage","length","action"],"mappings":"AAAA,YAEA,SAASA,iBAAgBC,EAAKC,EAAKC,GAAiK,MAApJD,KAAOD,GAAOG,OAAOC,eAAeJ,EAAKC,GAAOC,MAAOA,EAAOG,YAAY,EAAMC,cAAc,EAAMC,UAAU,IAAkBP,EAAIC,GAAOC,EAAgBF,EAE3MQ,OAAOC,UAAUC,UAAUC,YAAY,SAAUC,EAASC,EAAQC,GAEhE,GAAIC,GAAmBP,OAAOQ,KAAKC,WAE/BC,EAAe,WACjBC,EAAGC,OAASC,SAASC,cAAc,UACnCH,EAAGC,OAAOG,IAAM,sBAAwBf,OAAOgB,QAAQC,GAAK,cAC5DN,EAAGC,OAAOK,GAAK,gBACfJ,SAASK,KAAKC,YAAYR,EAAGC,QAE7BQ,IACAC,KAGEC,EAAe,WACjBX,EAAGY,QAAUC,EAAE,2EACfA,EAAE,QAAQC,OAAOd,EAAGY,SACpBZ,EAAGY,QAAQG,KACTC,WAAc,SACdC,SAAY,QACZC,IAAO,OACPC,KAAQ,MACRC,UAAa,mBACbC,aAAc,QACdC,UAAW,WACVC,KAAK,sBAAsBR,KAC5BS,QAAW,eACXC,YAAa,OACbC,OAAU,oBACVC,mBAAoB,UACpBC,QAAW,SACXC,gBAAiB,MACjBC,aAAc,4BACdC,MAAS,OACTC,cAAe,UAIfvB,EAAoB,WACtB,GAAIwB,GAEAf,EAAMhB,SAASK,KAAK2B,UAAY,GAAK,KACrCC,EAAQ,MACZtB,GAAE,kBAAkBE,KAAKkB,GACvBhB,SAAY,QACZK,UAAW,iBACXc,OAAU,QACVC,MAAS,QACTX,OAAU,EACVR,IAAOA,EACPiB,MAASA,GACRvD,gBAAgBqD,EAAQ,SAAU,qBAAsBrD,gBAAgBqD,EAAQ,aAAc,4BAA6BA,KAG5HvB,EAAgB,WAClB4B,OAAOC,iBAAiB,UAAW,SAAUC,GAC1B,kBAAbA,EAAKA,KACPC,IAC6B,eAApBD,EAAKA,KAAKE,QACnBC,EAAeH,EAAKA,MACF,SAAlBA,EAAKA,KAAKI,MAAmBC,KACA,cAApBL,EAAKA,KAAKE,QACnBI,IACkB,SAAlBN,EAAKA,KAAKI,MAAmBC,KACP,gBAAbL,EAAKA,KACdK,IAC6B,eAApBL,EAAKA,KAAKE,SACnBK,EAAUP,EAAKA,MACfK,QAKFF,EAAiB,SAAwBH,GAC3C,GAAIQ,GAAOpD,EAAiB,iBAAmB,cAAgB4C,EAAKS,OAAS,4GAA8GrD,EAAiB,sBAAwB,MAEpOI,GAAGY,QAAQG,IAAI,aAAc,WAAWQ,KAAK,sBAAsByB,KAAKA,GACxEE,WAAW,WACTlD,EAAGY,QAAQG,IAAI,aAAc,WAC5B,MAGD+B,EAAc,WAChB,GAAIE,GAAOpD,EAAiB,aAC5BI,GAAGY,QAAQG,IAAI,aAAc,WAAWQ,KAAK,sBAAsByB,KAAKA,GACxEE,WAAW,WACTlD,EAAGY,QAAQG,IAAI,aAAc,WAC5B,MAGDgC,EAAY,SAAmBP,GACjC,GAAIQ,GAAOpD,EAAiB,aAAe,cAAgB4C,EAAKS,OAAS,4GAA8GrD,EAAiB,SAAW,MAEnNI,GAAGY,QAAQG,IAAI,aAAc,WAAWQ,KAAK,sBAAsByB,KAAKA,GACxEE,WAAW,WACTlD,EAAGY,QAAQG,IAAI,aAAc,WAC5B,MAGD8B,EAAe,WACjBhC,EAAE,kBAAkBsC,UAGlBV,EAAsB,WACxB,GAAIW,GAAapD,EAAGC,OAAOoD,aAC3B5D,GAAQiD,OAAS,eACjBU,GAAcA,EAAWE,YAAY7D,EAAS,sBAAwBJ,OAAOgB,QAAQC,GAAK,eAGxFO,GAAE,kBAAkB0C,QACtBV,IAGEhC,EAAE,sBAAsB0C,QAC1B1C,EAAE,sBAAsBsC,QAG1B,IAAInD,KAE0B,eAA1BP,EAAQ+D,OAAOA,SACjBzD,IACAY","file":"context.js","sourcesContent":["'use strict';\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nchrome.extension.onMessage.addListener(function (request, sender, sendResponse) {\n\n  var getLocaleMessage = chrome.i18n.getMessage;\n\n  var createIframe = function createIframe() {\n    TT.iframe = document.createElement(\"iframe\");\n    TT.iframe.src = 'chrome-extension://' + chrome.runtime.id + '/popup.html';\n    TT.iframe.id = \"gnotes-iframe\";\n    document.body.appendChild(TT.iframe);\n\n    setIframePosition();\n    listenMessage();\n  };\n\n  var createStatus = function createStatus() {\n    TT.$status = $('<div id=\"gnotes-ext-status\"><div class=\"gnotes-ext-status\"></div></div>');\n    $('body').append(TT.$status);\n    TT.$status.css({\n      'visibility': 'hidden',\n      'position': 'fixed',\n      'top': '50px',\n      'left': '50%',\n      'transform': 'translateX(-50%)',\n      'margin-top': '-20px',\n      'z-index': 99999999\n    }).find('.gnotes-ext-status').css({\n      'display': 'inline-block',\n      'font-size': '14px',\n      'border': '1px solid #607D8B',\n      'background-color': '#607D8B',\n      'padding': '0 15px',\n      'border-radius': '2px',\n      'box-shadow': '0 2px 4px rgba(0,0,0,0.2)',\n      'color': '#fff',\n      'line-height': '40px'\n    });\n  };\n\n  var setIframePosition = function setIframePosition() {\n    var _$$css;\n\n    var top = document.body.clientTop + 20 + 'px',\n        right = '60px';\n    $('#gnotes-iframe').css((_$$css = {\n      'position': 'fixed',\n      'z-index': 11111111111111111,\n      'height': '400px',\n      'width': '345px',\n      'border': 0,\n      'top': top,\n      'right': right\n    }, _defineProperty(_$$css, 'border', '1px solid #ececec'), _defineProperty(_$$css, 'box-shadow', '0 0 10px rgba(0,0,0,.15)'), _$$css));\n  };\n\n  var listenMessage = function listenMessage() {\n    window.addEventListener(\"message\", function (data) {\n      if (data.data == 'load completed') {\n        postMessageToIframe();\n      } else if (data.data.status == 'add success') {\n        addTaskSuccess(data.data);\n        data.data.from == 'frame' && removeIframe();\n      } else if (data.data.status == 'add failed') {\n        addTaskFail();\n        data.data.from == 'frame' && removeIframe();\n      } else if (data.data == 'close iframe') {\n        removeIframe();\n      } else if (data.data.status == 'not_sign_on') {\n        needLogin(data.data);\n        removeIframe();\n      }\n    });\n  };\n\n  var addTaskSuccess = function addTaskSuccess(data) {\n    var html = getLocaleMessage('createSuccess') + \", <a href='\" + data.target + \"' target='_blank' style='color: #def7f0; text-decoration: underline; font-weight: bold; cursor: pointer'>\" + getLocaleMessage('createSuccessCheck') + \"</a>\";\n\n    TT.$status.css('visibility', 'visible').find('.gnotes-ext-status').html(html);\n    setTimeout(function () {\n      TT.$status.css('visibility', 'hidden');\n    }, 3000);\n  };\n\n  var addTaskFail = function addTaskFail() {\n    var html = getLocaleMessage('createFail');\n    TT.$status.css('visibility', 'visible').find('.gnotes-ext-status').html(html);\n    setTimeout(function () {\n      TT.$status.css('visibility', 'hidden');\n    }, 3000);\n  };\n\n  var needLogin = function needLogin(data) {\n    var html = getLocaleMessage('needLogin') + \", <a href='\" + data.target + \"' target='_blank' style='color: #def7f0; text-decoration: underline; font-weight: bold; cursor: pointer'>\" + getLocaleMessage('login') + \"</a>\";\n\n    TT.$status.css('visibility', 'visible').find('.gnotes-ext-status').html(html);\n    setTimeout(function () {\n      TT.$status.css('visibility', 'hidden');\n    }, 3000);\n  };\n\n  var removeIframe = function removeIframe() {\n    $('#gnotes-iframe').remove();\n  };\n\n  var postMessageToIframe = function postMessageToIframe() {\n    var sendIframe = TT.iframe.contentWindow;\n    request.status = 'init content';\n    sendIframe && sendIframe.postMessage(request, 'chrome-extension://' + chrome.runtime.id + '/popup.html');\n  };\n\n  if ($('#gnotes-iframe').length) {\n    removeIframe();\n  }\n\n  if ($('#gnotes-ext-status').length) {\n    $('#gnotes-ext-status').remove();\n  }\n\n  var TT = {};\n\n  if (request.action.action === \"openFrame\") {\n    createIframe();\n    createStatus();\n  }\n});"]}