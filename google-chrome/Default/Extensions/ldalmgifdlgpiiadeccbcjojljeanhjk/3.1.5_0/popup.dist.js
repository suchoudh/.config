!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=5)}({0:function(e,t,o){"use strict";let n={enableScreenshotEmbedding:!0,enableOpenLocationCode:!0,enableAutomaticScreenshotTagging:!0};t.a={save:e=>browser.storage.sync.set(e),load:()=>browser.storage.sync.get(n),onChange:e=>{browser.storage.onChanged.addListener((function(t){let o={};for(let e in n)o[e]=t[e].newValue;e(o)}))}}},5:function(e,t,o){"use strict";o.r(t);var n=o(0);
/**
 * @copyright Copyright (c) 2016-present, TagSpaces UG (haftungsbeschraenkt).
 * @license AGPL-3.0
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License, version 3,
 * as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License, version 3,
 * along with this program.  If not, see <http://www.gnu.org/licenses/>
 *
 */let r={};n.a.load().then(e=>r=e),$(document).ready((function(){b.then(e=>{for(let t of e){d=t.url,p=t.id,l.href=d,w(),c=P();let e=t.title.trim();e=e.replace(/[/\\?%*:|"<>]/g,"-"),$("#title").val(e),$("#title").focus(),s.indexOf(c)>=0?$("#downloadFile").show():$("#downloadFile").hide()}},e=>{console.warn("Error getting active tab: "+e)}),$("#title").focus(),a?$("#saveAsMhtml").hide():$("#saveAsMhtml").on("click",k),$("#closePopup").on("click",()=>window.close()),$("#saveAsBookmark").on("click",O),$("#saveSelectionAsHtml").on("click",A),$("#saveWholePageAsHtml").on("click",z),$("#saveScreenshot").on("click",E),$("#downloadFile").on("click",S),$("#simplifiedPreview").on("click",x),$("#fullPreview").on("click",C),$("[data-i18n]").each((function(){$(this).html(browser.i18n.getMessage($(this).data("i18n")))})),$("[data-i18n-title]").each((function(){$(this).attr("title",browser.i18n.getMessage($(this).data("i18n-title")))})),browser.runtime.onMessage.addListener(y),browser.tabs.executeScript(null,{file:"content-script-capture-wholepage.dist.js"}).then(()=>{console.log("Content script injected...")},e=>{console.warn("Error executing script "+JSON.stringify(e)),$("#preview").contents().find("html").html("Error while capturing content")}),browser.tabs.executeScript(null,{file:"content-script-capture-selection.dist.js"}).then(()=>{console.log("Content script injected...")},e=>{console.warn("Error executing script "+JSON.stringify(e)),$("#preview").contents().find("html").html("Error while capturing content")})})),console.log("Loading Popup...");const i=navigator.appVersion.includes("Win")?"\\":"/",a=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,s=(navigator.userAgent.toLowerCase().indexOf("chrome"),["png","jpg","jpeg","svg","webp","gif","bmp","ico","pdf","ogg","ogv","mp4","mp3"]),l=document.createElement("a");let c,d,p,m,f,h,u='<!DOCTYPE html><html><head><meta charset="UTF-8"><style type="text/css">/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}body{overflow:auto;font: Ubuntu,arial,clean,sans-serif;color:#000;line-height:1.4em;background-color:#fff;padding:20px}p{margin:1em 0;line-height:1.5em}table{font:100%;margin:1em}table th{border-bottom:1px solid #bbb;padding:.2em 1em}table td{border-bottom:1px solid #ddd;padding:.2em 1em}input[type=image],input[type=password],input[type=text],textarea{font:99% helvetica,arial,freesans,sans-serif}option,select{padding:0 .25em}optgroup{margin-top:.5em}code,pre{font:12px Monaco, Courier ,monospace}pre{margin:1em 0;font-size:12px;background-color:#eee;border:1px solid #ddd;padding:5px;line-height:1.5em;color:#444;overflow:auto;-webkit-box-shadow:rgba(0,0,0,.07) 0 1px 2px inset;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px}pre code{padding:0;font-size:12px;background-color:#eee;border:none}code{font-size:12px;background-color:#f8f8ff;color:#444;padding:0 .2em;border:1px solid #dedede}img{border:0;max-width:100%}abbr{border-bottom:none}a{color:#4183c4;text-decoration:none}a:hover{text-decoration:underline}a code,a:link code,a:visited code{color:#4183c4}h2,h3{margin:1em 0}h1,h2,h3,h4,h5,h6{border:0}h1{font-size:170%;border-top:4px solid #aaa;padding-top:.5em;margin-top:1.5em}h1:first-child{margin-top:0;padding-top:.25em;border-top:none}h2{font-size:150%;margin-top:1.5em;border-top:4px solid #e0e0e0;padding-top:.5em}h3{font-size:130%;margin-top:1em}h4{font-size:120%;margin-top:1em}h5{font-size:115%;margin-top:1em}h6{font-size:110%;margin-top:1em}hr{border:1px solid #ddd}ol,ul{margin:1em 0 1em 2em}ol li,ul li{margin-top:.5em;margin-bottom:.5em}ol ol,ol ul,ul ol,ul ul{margin-top:0;margin-bottom:0}blockquote{margin:1em 0;border-left:5px solid #ddd;padding-left:.6em;color:#555}dt{font-weight:700;margin-left:1em}dd{margin-left:2em;margin-bottom:1em}</style></head><body></body></html>',g="simplified";const b=browser.tabs.query({currentWindow:!0,active:!0});function w(){const e=new RegExp("(map=|@)(.*),(.*),"),t=new RegExp("\\d/(.*)/(.*)");if(l.href){let o,n,i=l.href.match(e),a=l.href.match(t);if(i&&i.length>1?(o=i[2],n=i[3]):a&&a.length>0&&(o=a[1],n=a[2]),o&&o.length>0&&n&&n.length>0){let e="";if(OpenLocationCode&&r.enableOpenLocationCode)try{e=OpenLocationCode.encode(parseFloat(o),parseFloat(n))}catch(e){console.warn("Error parsing lat long to float")}else n.startsWith("-")||(n="+"+n),e=o+n;const t=document.getElementById("tags").value.trim()+" "+e;t&&t.length>0&&(document.getElementById("tags").value=t.trim())}}}function v(e,t){saveAs(e,t)}function y(e){if("htmlcontent"==e.action&&(m=e.originalHTML,f=e.cleanedHTML),"htmlselection"==e.action&&(e.source.length<1||(h=e.source)),!h)return f?($("#preview").contents().find("html").html(f),void(g="simplified")):m?($("#preview").contents().find("html").html(m),void(g="original")):($("#contentModeSwitch").hide(),void $("#preview").contents().find("html").html("No content was extracted..."));$("#preview").contents().find("html").html(h)}function x(){f&&(g="simplified",$("#preview").contents().find("html").html(f))}function C(){m&&(g="original",$("#preview").contents().find("html").html(m))}function k(){$("#saveAsMhtml i").removeClass("fa-file-image-o").addClass("fa-spin fa-circle-o-notch"),browser.pageCapture.saveAsMHTML({tabId:p},e=>{v(e,M(c,"mht")),$("#saveAsMhtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-image-o")})}function S(){browser.downloads.download({url:d,filename:M(c),saveAs:!0})}function z(){$("#saveWholePageAsHtml i").removeClass("fa-file").addClass("fa-spin fa-circle-o-notch");let e="";if("simplified"===g?e=f:"original"===g&&(e=m),!e||e.length<1)return alert("No content extracted...."),$("#saveWholePageAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file"),void $("#saveSelectionAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-text");L(e).then(e=>{v(new Blob([e],{type:"text/html;charset=utf-8"}),M("html")),$("#saveWholePageAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file"),$("#saveSelectionAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-text")}).catch(e=>{alert("Error by preparing the HTML content..."),location.reload(),console.warn("Error handling html content "+e)})}function A(){if($("#saveSelectionAsHtml i").removeClass("fa-file-text").addClass("fa-spin fa-circle-o-notch"),!h||h.length<1)return alert("No content selected...."),$("#saveWholePageAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file"),void $("#saveSelectionAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-text");L(h).then(e=>{v(new Blob([e],{type:"text/html;charset=utf-8"}),M("html")),$("#saveWholePageAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file"),$("#saveSelectionAsHtml i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-file-text")}).catch(e=>{alert("Error by preparing the HTML content..."),console.warn("Error handling html content "+e)})}function E(){$("#saveScreenshot i").removeClass("fa-camera").addClass("fa-spin fa-circle-o-notch"),browser.tabs.captureVisibleTab(null,{format:"png"}).then(e=>{v(function(e){const t=atob(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length);let r=new Uint8Array(n);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);const i=new DataView(n);return new Blob([i],{type:o})}(e),M("png","screenshot")),$("#saveScreenshot i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-camera")},e=>console.warn("Error taking screenshot "+JSON.stringify(e)))}function O(){$("#saveAsBookmark i").removeClass("fa-bookmark").addClass("fa-spin fa-circle-o-notch"),browser.tabs.captureVisibleTab(null,{format:"jpeg"}).then(e=>{const t=r.enableScreenshotEmbedding?"COMMENT="+e+"\r\n":"";v(new Blob(["[InternetShortcut]\r\nURL="+d+"\r\n"+t],{type:"text/plain;charset=utf-8"}),M("url")),$("#saveAsBookmark i").removeClass("fa-spin fa-circle-o-notch").addClass("fa-bookmark")})}function M(e,t){let o=$("#title").val();const n=o.lastIndexOf(".");n>0&&o.length-n<5&&(o=o.substring(0,o.lastIndexOf(".")));const r=document.getElementById("tags").value.split(","),i=[];for(let e of r){let t=e.trim();t.length>1&&i.push(t)}return"screenshot"===t&&"png"===e.toLowerCase()&&(i.push("screenshot"),i.push(l?l.hostname:""),i.push(function(e,t){if(void 0===e||""===e)return"";const o=new Date(e);let n=o.getDate();n+="",1===n.length&&(n="0"+n);let r=o.getMonth();r++,r+="",1===r.length&&(r="0"+r);const i=o.getFullYear();let a="";if(t){let e=o.getHours();e+="",1===e.length&&(e="0"+e);let t=o.getMinutes();t+="",1===t.length&&(t="0"+t);let n=o.getSeconds();n+="",1===n.length&&(n="0"+n),a="~"+e+t+n}return i+""+r+n+a}((new Date).toString(),!1))),"mht"===t&&(e="mhtml"),o=i.length>0?o+" ["+i.join(" ")+"]."+e:o+"."+e,o=o.replace(/[/\\?%*:|"<>]/g,"-").trim(),o}function j(e){return new Promise(t=>{const o=document.createElement("canvas"),n=o.getContext("2d"),r=new Image;let i;r.src=e,r.crossOrigin="anonymous",r.onerror=o=>{console.warn("Error fetching image: "+JSON.stringify(o)),t([e,e])},r.onload=()=>{o.width=r.width,o.height=r.height,n.drawImage(r,0,0);try{i=o.toDataURL("image/jpeg",.9),t([e,i])}catch(e){t(["",i])}}})}function P(){let e=d;return l.search&&(e=l.origin+l.pathname),e.replace(/^.*?\.([a-zA-Z0-9]+)$/,"$1").toLowerCase()}function L(e){return new Promise(t=>{let o,n=DOMPurify.sanitize(e);const a=[];let s,c;const p=/<img.*?src=['"](.*?)['"]/g,m=[];for(;null!==(o=p.exec(n));)m.push(o[1]);for(let e of m)e.startsWith("data")||(e.startsWith("http")||e.startsWith("file")||(s=e,d.startsWith("file:")?(c=d.substring(0,d.lastIndexOf(i)+1),e=c+e):e=e.startsWith("/")?l.origin+e:d+e,n=n.split(s).join(e)),a.push(j(e)));Promise.all(a).then(e=>{e.forEach(e=>{n=n.split(' src="'+e[0]).join(' src="'+e[1]),n.includes("src='")&&(n=n.split(" src='"+e[0]).join(" src='"+e[1]))}),browser.tabs.captureVisibleTab(null,{format:"jpeg"}).then(e=>{let o='data-sourceurl="'+d+'" data-scrappedon="'+(new Date).toISOString()+'"';return e&&r.enableScreenshotEmbedding&&(o=o+' data-screenshot="'+e+'"'),n.includes("<body")?n=n.split("<body").join("<body "+o):(n="<body "+o+">"+n+"</body>",n=u.replace(/<body[^>]*>([^]*)<\/body>/m,n)),t(n)},e=>console.warn("Error taking screenshot "+JSON.stringify(e)))}).catch(e=>(console.warn("Error by preparing content: "+e),t(n)))})}}});
//# sourceMappingURL=popup.dist.js.map