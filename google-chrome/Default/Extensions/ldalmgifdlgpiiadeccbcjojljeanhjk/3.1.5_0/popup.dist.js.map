{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./lib/options-manager.js","webpack:///./ui/popup.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","DEFAULT_OPTIONS","enableScreenshotEmbedding","enableOpenLocationCode","enableAutomaticScreenshotTagging","save","params","browser","storage","sync","set","load","onChange","callback","onChanged","addListener","changes","callbackChanges","newValue","userSettings","then","options","$","document","ready","activeTabQuery","tabs","tab","currentTabURL","url","currentTabID","id","currentTabURLParser","href","extractLatLong","fileExt","extractFileExtFromUrl","title","trim","replace","val","focus","supportedExts","indexOf","show","hide","err","console","warn","isFirefox","on","saveAsMHTML","window","close","saveAsBookmark","saveSelectionAsHTML","saveWholePageAsHTML","saveScreenshot","downloadFile","simplifiedPreview","fullPreview","each","this","html","i18n","getMessage","data","attr","runtime","onMessage","handleHTML","executeScript","file","log","JSON","stringify","contents","find","dirSeparator","navigator","appVersion","includes","userAgent","toLowerCase","createElement","htmlOriginal","htmlCleaned","htmlSelection","htmlTemplate","contentMode","query","currentWindow","active","regexGMH","RegExp","regexOSM","lon","lat","lonLatMatch","match","lonLatMatch2","length","geoTag","OpenLocationCode","encode","parseFloat","startsWith","tagsText","getElementById","saveAsFile","blob","filename","saveAs","request","action","originalHTML","cleanedHTML","source","removeClass","addClass","pageCapture","tabId","mhtml","generateFileName","downloads","download","content","alert","prepareContentPromise","convertedHTML","Blob","type","catch","location","reload","cleanenHTML","captureVisibleTab","format","image","dataURI","byteString","atob","split","mimeString","arrayBuffer","ArrayBuffer","_ia","Uint8Array","charCodeAt","dataView","DataView","dataURItoBlob","imageDataUrl","screenshot","extension","lastIndexOfDot","lastIndexOf","substring","rawTags","tags","tag","trimmedTag","push","hostname","date","includeTime","undefined","Date","cDate","getDate","cMonth","getMonth","cYear","getFullYear","time","cHour","getHours","cMinute","getMinutes","cSecond","getSeconds","formatDateTime4Tag","toString","join","getBase64ImagePromise","imgURL","Promise","resolve","canvas","ctx","getContext","img","Image","dataURL","src","crossOrigin","onerror","onload","width","height","drawImage","toDataURL","e","search","origin","pathname","uncleanedHTML","DOMPurify","sanitize","urlPromises","originalImgUrl","baseTabPath","rex","imgSources","exec","imgUrl","all","resultUrls","forEach","dataURLObject","metaData","toISOString","error"],"mappings":"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","file":"popup.dist.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","let DEFAULT_OPTIONS = {\n  enableScreenshotEmbedding: true,\n  enableOpenLocationCode: true,\n  enableAutomaticScreenshotTagging: true\n};\n\nexport default {\n  save: (params) => {\n    return browser.storage.sync.set(params);\n  },\n\n  load: () => {\n    return browser.storage.sync.get(DEFAULT_OPTIONS)\n  },\n\n  onChange: (callback) => {\n    browser.storage.onChanged.addListener(function(changes) {\n      let callbackChanges = {};\n\n      for (let key in DEFAULT_OPTIONS) {\n        callbackChanges[key] = changes[key].newValue;\n      }\n\n      callback(callbackChanges);\n    })\n  }\n};\n","/**\n * @copyright Copyright (c) 2016-present, TagSpaces UG (haftungsbeschraenkt).\n * @license AGPL-3.0\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License, version 3,\n * as published by the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License, version 3,\n * along with this program.  If not, see <http://www.gnu.org/licenses/>\n *\n */\n/* globals $, saveAs, DOMPurify, OpenLocationCode */\nimport OptionsManager from \"../lib/options-manager.js\";\n\nlet userSettings = {};\nOptionsManager.load().then((options) => (userSettings = options));\n\n$(document).ready(init);\n\nconsole.log(\"Loading Popup...\");\n\nconst isWin = navigator.appVersion.includes(\"Win\");\nconst dirSeparator = isWin ? \"\\\\\" : \"/\";\nconst isFirefox = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\nconst isChrome = navigator.userAgent.toLowerCase().indexOf(\"chrome\") > -1;\nconst supportedExts = [\n  \"png\",\n  \"jpg\",\n  \"jpeg\",\n  \"svg\",\n  \"webp\",\n  \"gif\",\n  \"bmp\",\n  \"ico\",\n  \"pdf\",\n  \"ogg\",\n  \"ogv\",\n  \"mp4\",\n  \"mp3\",\n];\nconst currentTabURLParser = document.createElement(\"a\");\nlet cssReadability =\n  \"body{overflow:auto;font: Ubuntu,arial,clean,sans-serif;color:#000;line-height:1.4em;background-color:#fff;padding:20px}p{margin:1em 0;line-height:1.5em}table{font:100%;margin:1em}table th{border-bottom:1px solid #bbb;padding:.2em 1em}table td{border-bottom:1px solid #ddd;padding:.2em 1em}input[type=image],input[type=password],input[type=text],textarea{font:99% helvetica,arial,freesans,sans-serif}option,select{padding:0 .25em}optgroup{margin-top:.5em}code,pre{font:12px Monaco, Courier ,monospace}pre{margin:1em 0;font-size:12px;background-color:#eee;border:1px solid #ddd;padding:5px;line-height:1.5em;color:#444;overflow:auto;-webkit-box-shadow:rgba(0,0,0,.07) 0 1px 2px inset;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px}pre code{padding:0;font-size:12px;background-color:#eee;border:none}code{font-size:12px;background-color:#f8f8ff;color:#444;padding:0 .2em;border:1px solid #dedede}img{border:0;max-width:100%}abbr{border-bottom:none}a{color:#4183c4;text-decoration:none}a:hover{text-decoration:underline}a code,a:link code,a:visited code{color:#4183c4}h2,h3{margin:1em 0}h1,h2,h3,h4,h5,h6{border:0}h1{font-size:170%;border-top:4px solid #aaa;padding-top:.5em;margin-top:1.5em}h1:first-child{margin-top:0;padding-top:.25em;border-top:none}h2{font-size:150%;margin-top:1.5em;border-top:4px solid #e0e0e0;padding-top:.5em}h3{font-size:130%;margin-top:1em}h4{font-size:120%;margin-top:1em}h5{font-size:115%;margin-top:1em}h6{font-size:110%;margin-top:1em}hr{border:1px solid #ddd}ol,ul{margin:1em 0 1em 2em}ol li,ul li{margin-top:.5em;margin-bottom:.5em}ol ol,ol ul,ul ol,ul ul{margin-top:0;margin-bottom:0}blockquote{margin:1em 0;border-left:5px solid #ddd;padding-left:.6em;color:#555}dt{font-weight:700;margin-left:1em}dd{margin-left:2em;margin-bottom:1em}\";\nlet cssReset =\n  \"/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}\";\nlet htmlTemplate =\n  '<!DOCTYPE html><html><head><meta charset=\"UTF-8\"><style type=\"text/css\">' +\n  cssReset +\n  cssReadability +\n  \"</style></head><body></body></html>\";\nlet fileExt;\nlet currentTabURL;\nlet currentTabID;\nlet htmlOriginal;\nlet htmlCleaned;\nlet htmlSelection;\nlet contentMode = \"simplified\"; // 'original'\nconst activeTabQuery = browser.tabs.query({\n  currentWindow: true,\n  active: true,\n});\n\nfunction init() {\n  // console.log('Settings: ' + JSON.stringify(userSettings));\n\n  activeTabQuery.then(\n    (tabs) => {\n      for (let tab of tabs) {\n        currentTabURL = tab.url;\n        currentTabID = tab.id;\n        currentTabURLParser.href = currentTabURL;\n        extractLatLong();\n        fileExt = extractFileExtFromUrl();\n        let title = tab.title.trim();\n        title = title.replace(/[/\\\\?%*:|\"<>]/g, \"-\");\n        $(\"#title\").val(title);\n        $(\"#title\").focus();\n        supportedExts.indexOf(fileExt) >= 0\n          ? $(\"#downloadFile\").show()\n          : $(\"#downloadFile\").hide();\n      }\n    },\n    (err) => {\n      console.warn(\"Error getting active tab: \" + err);\n    }\n  );\n\n  $(\"#title\").focus();\n  isFirefox\n    ? $(\"#saveAsMhtml\").hide()\n    : $(\"#saveAsMhtml\").on(\"click\", saveAsMHTML);\n  // isChrome ? $(\"#saveWholePageAsHtml\").hide() : '';\n  $(\"#closePopup\").on(\"click\", () => window.close());\n  $(\"#saveAsBookmark\").on(\"click\", saveAsBookmark);\n  $(\"#saveSelectionAsHtml\").on(\"click\", saveSelectionAsHTML);\n  $(\"#saveWholePageAsHtml\").on(\"click\", saveWholePageAsHTML);\n  $(\"#saveScreenshot\").on(\"click\", saveScreenshot);\n  $(\"#downloadFile\").on(\"click\", downloadFile);\n  $(\"#simplifiedPreview\").on(\"click\", simplifiedPreview);\n  $(\"#fullPreview\").on(\"click\", fullPreview);\n\n  // I18n this panel\n  $(\"[data-i18n]\").each(function () {\n    $(this).html(browser.i18n.getMessage($(this).data(\"i18n\")));\n  });\n  $(\"[data-i18n-title]\").each(function () {\n    $(this).attr(\"title\", browser.i18n.getMessage($(this).data(\"i18n-title\")));\n  });\n\n  browser.runtime.onMessage.addListener(handleHTML);\n\n  browser.tabs\n    .executeScript(null, {\n      file: \"content-script-capture-wholepage.dist.js\",\n    })\n    .then(\n      () => {\n        console.log(\"Content script injected...\");\n      },\n      (err) => {\n        console.warn(\"Error executing script \" + JSON.stringify(err));\n        $(\"#preview\")\n          .contents()\n          .find(\"html\")\n          .html(\"Error while capturing content\");\n        // alert('Error getting content from the current tab.')\n        // location.reload();\n      }\n    );\n\n  browser.tabs\n    .executeScript(null, {\n      file: \"content-script-capture-selection.dist.js\",\n    })\n    .then(\n      () => {\n        console.log(\"Content script injected...\");\n      },\n      (err) => {\n        console.warn(\"Error executing script \" + JSON.stringify(err));\n        $(\"#preview\")\n          .contents()\n          .find(\"html\")\n          .html(\"Error while capturing content\");\n        // alert('Error getting content from the current tab.')\n        // location.reload();\n      }\n    );\n}\n\n// Geo locations:\n// GMaps: https://www.google.de/maps/@48.1401285,11.5732137,15.25z\n// GMaps: https://www.google.de/maps/@-20.8096591,-49.3801033,16z\n// OpenStreetMap: https://www.openstreetmap.org/#map=17/48.13504/11.59057\n// OpenStreetMap: https://www.openstreetmap.org/#map=16/-20.8077/-49.3785\n// Here: https://wego.here.com/?map=-20.80625,-49.37421,16,normal\n// Bing: no url param\nfunction extractLatLong() {\n  // const regex = new RegExp('@(.*),(.*),'); // gmaps only\n  const regexGMH = new RegExp(\"(map=|@)(.*),(.*),\"); // gmaps and here\n  const regexOSM = new RegExp(\"\\\\d/(.*)/(.*)\"); // open street map\n  if (currentTabURLParser.href) {\n    let lonLatMatch = currentTabURLParser.href.match(regexGMH);\n    let lonLatMatch2 = currentTabURLParser.href.match(regexOSM);\n    let lon;\n    let lat;\n    if (lonLatMatch && lonLatMatch.length > 1) {\n      lon = lonLatMatch[2];\n      lat = lonLatMatch[3];\n    } else if (lonLatMatch2 && lonLatMatch2.length > 0) {\n      lon = lonLatMatch2[1];\n      lat = lonLatMatch2[2];\n    }\n    if (lon && lon.length > 0 && lat && lat.length > 0) {\n      let geoTag = \"\";\n      if (OpenLocationCode && userSettings.enableOpenLocationCode) {\n        try {\n          geoTag = OpenLocationCode.encode(parseFloat(lon), parseFloat(lat));\n        } catch (err) {\n          console.warn(\"Error parsing lat long to float\");\n        }\n      } else {\n        if (!lat.startsWith(\"-\")) {\n          lat = \"+\" + lat;\n        }\n        geoTag = lon + lat;\n      }\n      const tagsText =\n        document.getElementById(\"tags\").value.trim() + \" \" + geoTag;\n      if (tagsText && tagsText.length > 0) {\n        document.getElementById(\"tags\").value = tagsText.trim();\n      }\n    }\n  }\n}\n\nfunction saveAsFile(blob, filename) {\n  // if (isFirefox) {\n  saveAs(blob, filename);\n  // } else {\n  //   browser.downloads.download({\n  //     url: URL.createObjectURL(blob),\n  //     filename: filename,\n  //     saveAs: true,\n  //   });\n  // }\n}\n\nfunction handleHTML(request) {\n  if (request.action == \"htmlcontent\") {\n    // console.log(\"HTML: \" + request.source);\n    htmlOriginal = request.originalHTML;\n    htmlCleaned = request.cleanedHTML;\n  }\n  if (request.action == \"htmlselection\") {\n    // console.log(\"HTML: \" + request.source);\n    if (request.source.length < 1) {\n      // alert('No content selected....');\n    } else {\n      htmlSelection = request.source;\n    }\n  }\n  if (htmlSelection) {\n    $(\"#preview\").contents().find(\"html\").html(htmlSelection);\n    // $('#saveWholePageAsHtml').attr(\"disabled\",true);\n    // $('#saveSelectionAsHtml').attr(\"disabled\",false);\n    return;\n  } else if (htmlCleaned) {\n    $(\"#preview\").contents().find(\"html\").html(htmlCleaned);\n    // $('#saveSelectionAsHtml').attr(\"disabled\",true);\n    // $('#saveWholePageAsHtml').attr(\"disabled\",false);\n    contentMode = \"simplified\";\n    return;\n  } else if (htmlOriginal) {\n    $(\"#preview\").contents().find(\"html\").html(htmlOriginal);\n    // $('#saveSelectionAsHtml').attr(\"disabled\",true);\n    // $('#saveWholePageAsHtml').attr(\"disabled\",false);\n    contentMode = \"original\";\n    return;\n  } else {\n    $(\"#contentModeSwitch\").hide();\n    $(\"#preview\").contents().find(\"html\").html(\"No content was extracted...\");\n  }\n}\n\nfunction simplifiedPreview() {\n  if (htmlCleaned) {\n    contentMode = \"simplified\";\n    $(\"#preview\").contents().find(\"html\").html(htmlCleaned);\n  }\n}\n\nfunction fullPreview() {\n  if (htmlOriginal) {\n    contentMode = \"original\";\n    $(\"#preview\").contents().find(\"html\").html(htmlOriginal);\n  }\n}\n\nfunction saveAsMHTML() {\n  $(\"#saveAsMhtml i\")\n    .removeClass(\"fa-file-image-o\")\n    .addClass(\"fa-spin fa-circle-o-notch\");\n  browser.pageCapture.saveAsMHTML(\n    {\n      tabId: currentTabID,\n    },\n    (mhtml) => {\n      saveAsFile(mhtml, generateFileName(fileExt, \"mht\"));\n      $(\"#saveAsMhtml i\")\n        .removeClass(\"fa-spin fa-circle-o-notch\")\n        .addClass(\"fa-file-image-o\");\n    }\n  );\n}\n\nfunction downloadFile() {\n  browser.downloads.download({\n    url: currentTabURL,\n    filename: generateFileName(fileExt),\n    saveAs: true,\n  });\n}\n\nfunction saveWholePageAsHTML() {\n  $(\"#saveWholePageAsHtml i\")\n    .removeClass(\"fa-file\")\n    .addClass(\"fa-spin fa-circle-o-notch\");\n  let content = \"\";\n  if (contentMode === \"simplified\") {\n    content = htmlCleaned;\n  } else if (contentMode === \"original\") {\n    content = htmlOriginal;\n  }\n  if (!content || content.length < 1) {\n    alert(\"No content extracted....\");\n    $(\"#saveWholePageAsHtml i\")\n      .removeClass(\"fa-spin fa-circle-o-notch\")\n      .addClass(\"fa-file\");\n    $(\"#saveSelectionAsHtml i\")\n      .removeClass(\"fa-spin fa-circle-o-notch\")\n      .addClass(\"fa-file-text\");\n    return;\n  }\n  prepareContentPromise(content)\n    .then((convertedHTML) => {\n      const htmlBlob = new Blob([convertedHTML], {\n        type: \"text/html;charset=utf-8\",\n      });\n      saveAsFile(htmlBlob, generateFileName(\"html\"));\n      $(\"#saveWholePageAsHtml i\")\n        .removeClass(\"fa-spin fa-circle-o-notch\")\n        .addClass(\"fa-file\");\n      $(\"#saveSelectionAsHtml i\")\n        .removeClass(\"fa-spin fa-circle-o-notch\")\n        .addClass(\"fa-file-text\");\n    })\n    .catch((err) => {\n      alert(\"Error by preparing the HTML content...\");\n      location.reload();\n      console.warn(\"Error handling html content \" + err);\n    });\n}\n\nfunction saveSelectionAsHTML() {\n  $(\"#saveSelectionAsHtml i\")\n    .removeClass(\"fa-file-text\")\n    .addClass(\"fa-spin fa-circle-o-notch\");\n  if (!htmlSelection || htmlSelection.length < 1) {\n    alert(\"No content selected....\");\n    $(\"#saveWholePageAsHtml i\")\n      .removeClass(\"fa-spin fa-circle-o-notch\")\n      .addClass(\"fa-file\");\n    $(\"#saveSelectionAsHtml i\")\n      .removeClass(\"fa-spin fa-circle-o-notch\")\n      .addClass(\"fa-file-text\");\n    return;\n  }\n  prepareContentPromise(htmlSelection)\n    .then((cleanenHTML) => {\n      const htmlBlob = new Blob([cleanenHTML], {\n        type: \"text/html;charset=utf-8\",\n      });\n      saveAsFile(htmlBlob, generateFileName(\"html\"));\n      $(\"#saveWholePageAsHtml i\")\n        .removeClass(\"fa-spin fa-circle-o-notch\")\n        .addClass(\"fa-file\");\n      $(\"#saveSelectionAsHtml i\")\n        .removeClass(\"fa-spin fa-circle-o-notch\")\n        .addClass(\"fa-file-text\");\n    })\n    .catch((err) => {\n      alert(\"Error by preparing the HTML content...\");\n      // location.reload();\n      console.warn(\"Error handling html content \" + err);\n    });\n}\n\nfunction saveScreenshot() {\n  $(\"#saveScreenshot i\")\n    .removeClass(\"fa-camera\")\n    .addClass(\"fa-spin fa-circle-o-notch\");\n  const capturing = browser.tabs.captureVisibleTab(null, {\n    format: \"png\",\n  });\n  capturing.then(\n    (image) => {\n      saveAsFile(dataURItoBlob(image), generateFileName(\"png\", \"screenshot\"));\n      $(\"#saveScreenshot i\")\n        .removeClass(\"fa-spin fa-circle-o-notch\")\n        .addClass(\"fa-camera\");\n    },\n    (err) => console.warn(\"Error taking screenshot \" + JSON.stringify(err))\n  );\n}\n\nfunction saveAsBookmark() {\n  $(\"#saveAsBookmark i\")\n    .removeClass(\"fa-bookmark\")\n    .addClass(\"fa-spin fa-circle-o-notch\");\n  const capturing = browser.tabs.captureVisibleTab(null, { format: \"jpeg\" });\n  capturing.then((imageDataUrl) => {\n    // Make capturing optional, evtl. resize the image\n    const screenshot = userSettings.enableScreenshotEmbedding\n      ? \"COMMENT=\" + imageDataUrl + \"\\r\\n\"\n      : \"\";\n    const content =\n      \"[InternetShortcut]\\r\\nURL=\" + currentTabURL + \"\\r\\n\" + screenshot;\n    const textBlob = new Blob([content], {\n      type: \"text/plain;charset=utf-8\",\n    });\n    saveAsFile(textBlob, generateFileName(\"url\"));\n    $(\"#saveAsBookmark i\")\n      .removeClass(\"fa-spin fa-circle-o-notch\")\n      .addClass(\"fa-bookmark\");\n  });\n}\n\nfunction generateFileName(extension, type) {\n  let filename = $(\"#title\").val();\n  const lastIndexOfDot = filename.lastIndexOf(\".\");\n  // removing the extension if the dot in for 4 or less character before the end of the title\n  if (lastIndexOfDot > 0 && filename.length - lastIndexOfDot < 5) {\n    filename = filename.substring(0, filename.lastIndexOf(\".\"));\n  }\n\n  const rawTags = document.getElementById(\"tags\").value.split(\",\");\n  const tags = [];\n  for (let tag of rawTags) {\n    let trimmedTag = tag.trim();\n    if (trimmedTag.length > 1) {\n      // setting minimum tag length of 2\n      tags.push(trimmedTag);\n    }\n  }\n  if (type === \"screenshot\" && extension.toLowerCase() === \"png\") {\n    // screenshot case\n    tags.push(\"screenshot\");\n    tags.push(currentTabURLParser ? currentTabURLParser.hostname : \"\");\n    tags.push(formatDateTime4Tag(new Date().toString(), false));\n  }\n  if (type === \"mht\") {\n    extension = \"mhtml\";\n  }\n  if (tags.length > 0) {\n    filename = filename + \" [\" + tags.join(\" \") + \"].\" + extension;\n  } else {\n    filename = filename + \".\" + extension;\n  }\n  filename = filename.replace(/[/\\\\?%*:|\"<>]/g, \"-\").trim();\n  return filename;\n}\n\nfunction dataURItoBlob(dataURI) {\n  // convert base64 to raw binary data held in a string\n  const byteString = atob(dataURI.split(\",\")[1]);\n  // separate out the mime component\n  const mimeString = dataURI.split(\",\")[0].split(\":\")[1].split(\";\")[0];\n  // write the bytes of the string to an ArrayBuffer\n  const arrayBuffer = new ArrayBuffer(byteString.length);\n  let _ia = new Uint8Array(arrayBuffer);\n  for (let i = 0; i < byteString.length; i++) {\n    _ia[i] = byteString.charCodeAt(i);\n  }\n  const dataView = new DataView(arrayBuffer);\n  const blob = new Blob([dataView], {\n    type: mimeString,\n  });\n  return blob;\n}\n\nfunction getBase64ImagePromise(imgURL) {\n  return new Promise((resolve) => {\n    let mimeType = \"image/jpeg\";\n    // if (imgURL.endsWith('gif')) {\n    //   mimeType = 'image/gif';\n    // }\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\");\n    const img = new Image();\n    let dataURL;\n    img.src = imgURL;\n    img.crossOrigin = \"anonymous\";\n    img.onerror = (err) => {\n      console.warn(\"Error fetching image: \" + JSON.stringify(err));\n      resolve([imgURL, imgURL]);\n    };\n    img.onload = () => {\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0);\n      try {\n        dataURL = canvas.toDataURL(mimeType, 0.9);\n        resolve([imgURL, dataURL]);\n      } catch (e) {\n        resolve([\"\", dataURL]);\n      }\n    };\n  });\n}\n\nfunction extractFileExtFromUrl() {\n  let url = currentTabURL;\n  if (currentTabURLParser.search) {\n    url = currentTabURLParser.origin + currentTabURLParser.pathname;\n  }\n  const ext = url.replace(/^.*?\\.([a-zA-Z0-9]+)$/, \"$1\");\n  return ext.toLowerCase();\n}\n\nfunction prepareContentPromise(uncleanedHTML) {\n  return new Promise((resolve) => {\n    // let cleanedHTML = uncleanedHTML.replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, \"\");\n    let cleanedHTML = DOMPurify.sanitize(uncleanedHTML);\n\n    // saving all images as jpg in base64 format\n    let match;\n    const urlPromises = [];\n    let originalImgUrl;\n    let baseTabPath;\n    const rex = /<img.*?src=['\"](.*?)['\"]/g;\n    const imgSources = [];\n\n    while ((match = rex.exec(cleanedHTML)) !== null) {\n      imgSources.push(match[1]);\n      // console.log(`Found ${match[1]} in ${match[0]}`);\n    }\n    for (let imgUrl of imgSources) {\n      if (imgUrl.startsWith(\"data\")) {\n        // ignoring data urls\n      } else if (imgUrl.startsWith(\"http\") || imgUrl.startsWith(\"file\")) {\n        urlPromises.push(getBase64ImagePromise(imgUrl));\n      } else {\n        originalImgUrl = imgUrl;\n        if (currentTabURL.startsWith(\"file:\")) {\n          baseTabPath = currentTabURL.substring(\n            0,\n            currentTabURL.lastIndexOf(dirSeparator) + 1\n          );\n          imgUrl = baseTabPath + imgUrl;\n        } else if (imgUrl.startsWith(\"/\")) {\n          imgUrl = currentTabURLParser.origin + imgUrl;\n        } else {\n          imgUrl = currentTabURL + imgUrl;\n        }\n        cleanedHTML = cleanedHTML.split(originalImgUrl).join(imgUrl);\n        urlPromises.push(getBase64ImagePromise(imgUrl));\n      }\n      // console.log(\"URLs: \" + imgUrl);\n    }\n\n    Promise.all(urlPromises)\n      .then((resultUrls) => {\n        resultUrls.forEach((dataURLObject) => {\n          cleanedHTML = cleanedHTML\n            .split(' src=\"' + dataURLObject[0])\n            .join(' src=\"' + dataURLObject[1]); // ensure to replace only src=\"...\" and not data-src=\"..\"\n          if (cleanedHTML.includes(\"src='\")) {\n            cleanedHTML = cleanedHTML\n              .split(\" src='\" + dataURLObject[0])\n              .join(\" src='\" + dataURLObject[1]);\n          }\n          // cleanedHTML = cleanedHTML.split(dataURLObject[0]).join(dataURLObject[1]);\n        });\n\n        const capturing = browser.tabs.captureVisibleTab(null, {\n          format: \"jpeg\",\n        });\n        capturing.then(\n          (imageDataUrl) => {\n            // Make capturing optional, evtl. resize the image\n            let metaData =\n              'data-sourceurl=\"' +\n              currentTabURL +\n              '\" data-scrappedon=\"' +\n              new Date().toISOString() +\n              '\"';\n            if (imageDataUrl && userSettings.enableScreenshotEmbedding) {\n              metaData = metaData + ' data-screenshot=\"' + imageDataUrl + '\"';\n            }\n            if (cleanedHTML.includes(\"<body\")) {\n              cleanedHTML = cleanedHTML\n                .split(\"<body\")\n                .join(\"<body \" + metaData);\n            } else {\n              cleanedHTML = \"<body \" + metaData + \">\" + cleanedHTML + \"</body>\";\n              cleanedHTML = htmlTemplate.replace(\n                /<body[^>]*>([^]*)<\\/body>/m,\n                cleanedHTML\n              );\n            }\n            // console.log('Content before saving: ' + cleanedHTML);\n            return resolve(cleanedHTML);\n          },\n          (err) =>\n            console.warn(\"Error taking screenshot \" + JSON.stringify(err))\n        );\n      })\n      .catch((error) => {\n        console.warn(\"Error by preparing content: \" + error);\n        return resolve(cleanedHTML);\n      });\n  });\n}\n\nfunction formatDateTime4Tag(date, includeTime) {\n  if (date === undefined || date === \"\") {\n    return \"\";\n  }\n  const d = new Date(date);\n  let cDate = d.getDate();\n  cDate += \"\";\n  if (cDate.length === 1) {\n    cDate = \"0\" + cDate;\n  }\n  let cMonth = d.getMonth();\n  cMonth++;\n  cMonth += \"\";\n  if (cMonth.length === 1) {\n    cMonth = \"0\" + cMonth;\n  }\n  const cYear = d.getFullYear();\n\n  let time = \"\";\n  if (includeTime) {\n    let cHour = d.getHours();\n    cHour += \"\";\n    if (cHour.length === 1) {\n      cHour = \"0\" + cHour;\n    }\n    let cMinute = d.getMinutes();\n    cMinute += \"\";\n    if (cMinute.length === 1) {\n      cMinute = \"0\" + cMinute;\n    }\n    let cSecond = d.getSeconds();\n    cSecond += \"\";\n    if (cSecond.length === 1) {\n      cSecond = \"0\" + cSecond;\n    }\n    time = \"~\" + cHour + \"\" + cMinute + \"\" + cSecond;\n  }\n\n  return cYear + \"\" + cMonth + \"\" + cDate + time;\n}\n"],"sourceRoot":""}